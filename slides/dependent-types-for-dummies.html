<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="Arnaud Bailly - @dr_c0d3">
  <meta name="dcterms.date" content="2022-10-24">
  <title>Dependently Typed Programming for Dummies</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="/reveal.js/dist/reset.css">
  <link rel="stylesheet" href="/reveal.js/dist/reveal.css">
  <style>
    .reveal .sourceCode {  /* see #7635 */
      overflow: visible;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #cccccc; background-color: #303030; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ffcfaf; } /* Alert */
    code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
    code span.at { } /* Attribute */
    code span.bn { color: #dca3a3; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #f0dfaf; } /* ControlFlow */
    code span.ch { color: #dca3a3; } /* Char */
    code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
    code span.co { color: #7f9f7f; } /* Comment */
    code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
    code span.do { color: #7f9f7f; } /* Documentation */
    code span.dt { color: #dfdfbf; } /* DataType */
    code span.dv { color: #dcdccc; } /* DecVal */
    code span.er { color: #c3bf9f; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #c0bed1; } /* Float */
    code span.fu { color: #efef8f; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
    code span.kw { color: #f0dfaf; } /* Keyword */
    code span.op { color: #f0efd0; } /* Operator */
    code span.ot { color: #efef8f; } /* Other */
    code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
    code span.sc { color: #dca3a3; } /* SpecialChar */
    code span.ss { color: #cc9393; } /* SpecialString */
    code span.st { color: #cc9393; } /* String */
    code span.va { } /* Variable */
    code span.vs { color: #cc9393; } /* VerbatimString */
    code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="/reveal.js/dist/theme/virgil-black-iohk.css" id="theme">
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section id="title-slide">
  <h1 class="title">Dependently Typed Programming for Dummies</h1>
  <p class="subtitle">More powerful types for better domain modeling</p>
  <p class="author">Arnaud Bailly - <span class="citation"
data-cites="dr_c0d3">@dr_c0d3</span></p>
  <p class="date">2022-10-24</p>
</section>

<section id="agenda" class="slide level2">
<h2>Agenda</h2>
<ul>
<li class="fragment">Why?</li>
<li class="fragment">Gregorian dates</li>
<li class="fragment">Double-Entry Accounting</li>
<li class="fragment">An Online Wargame</li>
<li class="fragment">Conclusion</li>
</ul>
</section>
<section>
<section id="why" class="title-slide slide level1">
<h1>Why?</h1>

</section>
<section id="the-quest-for-better-software" class="slide level2">
<h2>The Quest for Better Software</h2>
<ul>
<li class="fragment"><em>Test-Driven Development</em> <span
class="math inline">‚Üí</span> Executable ‚Äúspecification‚Äù of goal</li>
<li class="fragment"><em>Domain-Driven Design</em> <span
class="math inline">‚Üí</span> Expressing solution in the language of the
problem</li>
<li class="fragment"><em>TDD + DDD</em> <span
class="math inline">‚Üí</span> <em>Type-Driven Development</em>?</li>
</ul>
<aside class="notes">
<ul>
<li>Question mark implies I am still <em>exploring</em> the relevance of
using dependent types in domain modelling</li>
<li>There‚Äôs definitely a dimension of fun and learning new stuff =&gt;
never did any Coq or Agda before!</li>
<li>I became involved in Idris because I was on of Edwin‚Äôs book
reviewers</li>
</ul>
</aside>
</section>
<section id="goal-for-this-talk" class="slide level2">
<h2>Goal for this Talk</h2>
<ul>
<li class="fragment">Make PLT researchers <span class="emoji"
data-emoji="smile">üòÑ</span></li>
<li class="fragment">Give people incentive to start hacking in and on
Idris 2</li>
<li class="fragment">Demonstrate 1st class <em>Dependent Types</em> are
useful to grow software</li>
<li class="fragment">Spark discussions on possibles use cases for Idris
2 w/in Cardano</li>
</ul>
</section>
<section id="caveat-emptor" class="slide level2">
<h2>Caveat Emptor</h2>
<blockquote>
<p>No theorem has been harmed in making this talk</p>
</blockquote>
<ul>
<li class="fragment">This talk is an experience report from a
professional developer but not being paid for coding in Idris</li>
<li class="fragment">It definitely leans towards the D side of
R&amp;D!</li>
</ul>
</section></section>
<section>
<section id="a-first-dip-dates" class="title-slide slide level1">
<h1>A first dip: Dates</h1>

</section>
<section id="problem-statement" class="slide level2">
<h2>Problem Statement</h2>
<blockquote>
<p>Define a Gregorian calendar <code>Date</code> type along with and
<code>addDays</code> function. The <code>Date</code> must always be
correct, eg. it should not be possible to define a <code>Date</code>
like 2022-02-29 or 2020-06-31.</p>
</blockquote>
</section>
<section id="base-types-adddays" class="slide level2">
<h2>Base types: <code>addDays</code></h2>
<div class="sourceCode" id="cb1"><pre
class="sourceCode idris"><code class="sourceCode idris"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">addDays</span> <span class="ot">:</span>  (d <span class="ot">:</span> <span class="dt">Date</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>        <span class="ot">-&gt;</span> (n <span class="ot">:</span> <span class="dt">Nat</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>        <span class="ot">-&gt;</span> <span class="dt">Date</span></span></code></pre></div>
<aside class="notes">
<ul>
<li>Some minor differences with Haskell</li>
<li>Types are declared with single colon character</li>
<li>Type of parameters can be named, which is useful for both
documentation and referring to those names as variables in in other
parts of the signature</li>
</ul>
</aside>
</section>
<section id="base-types-date" class="slide level2">
<h2>Base types: <code>Date</code></h2>
<p>The <code>MkDate</code> constructor embeds constraints we are
interested in</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode idris"><code class="sourceCode idris"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Year</span> <span class="ot">:</span> <span class="dt">Type</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="dt">Year</span> <span class="fu">=</span> <span class="dt">Nat</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Month</span> <span class="fu">=</span> <span class="dt">January</span> <span class="fu">|</span> <span class="dt">February</span> <span class="fu">|</span> <span class="dt">March</span> <span class="fu">|</span> <span class="fu">...</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Date</span> <span class="ot">:</span> <span class="dt">Type</span> <span class="kw">where</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">MkDate</span> <span class="ot">:</span> (year  <span class="ot">:</span> <span class="dt">Year</span>) <span class="ot">-&gt;</span> (month <span class="ot">:</span> <span class="dt">Month</span> ) <span class="ot">-&gt;</span> (day <span class="ot">:</span> <span class="dt">Nat</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>         <span class="ot">-&gt;</span> { <span class="kw">auto</span> dayFitInMonth <span class="ot">:</span> <span class="dt">LTE</span> day (daysInMonth month year) }</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>         <span class="ot">-&gt;</span> { <span class="kw">auto</span> dayGreaterThanOne <span class="ot">:</span> <span class="dt">LTE</span> <span class="dv">1</span> day }</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>         <span class="ot">-&gt;</span> <span class="dt">Date</span></span></code></pre></div>
<aside class="notes">
<ul>
<li>type aliases are just type-level CAFs or functions</li>
<li>data types can be declared like in Haskell but usually are declared
with GADTs syntax</li>
<li>This might not be the representation, something I learnt later:
Adding constraints to constructors this way is cumbersome in larger
programs</li>
<li>Would have been better to define a proper types for days</li>
</ul>
</aside>
</section>
<section id="implementing-adddays" class="slide level2">
<h2>Implementing <code>addDays</code></h2>
<p>Grunt of the work is done by the <code>addOneDay</code> function</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode idris"><code class="sourceCode idris"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>addDays d <span class="dt">Z</span>     <span class="fu">=</span> d</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>addDays d (<span class="dt">S</span> k) <span class="fu">=</span> addDays (addOneDay d) k</span></code></pre></div>
<aside class="notes">
<ul>
<li>usual pattern matching and recursion</li>
</ul>
</aside>
</section>
<section id="implementing-addoneday" class="slide level2">
<h2>Implementing <code>addOneDay</code></h2>
<p>The easy case</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode idris"><code class="sourceCode idris"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>addOneDay (<span class="dt">MkDate</span> year month day) <span class="fu">=</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">case</span> order {to<span class="fu">=</span><span class="dt">LTE</span>} (<span class="dt">S</span> day) (daysInMonth month year) <span class="kw">of</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">Left</span> <span class="fu">_</span>  <span class="ot">=&gt;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">MkDate</span> year month (<span class="dt">S</span> day)</span></code></pre></div>
<aside class="notes">
<ul>
<li><code>order a b</code> result type is <code>Either (LTE a b) (LTE b
a)</code> -&gt; we get a proof of the relation between 2 numbers</li>
<li><code>Left</code> is the easy case: the given day is strictly less
than the number of days in the month so we can just add it</li>
</ul>
</aside>
</section>
<section id="implementing-addoneday-1" class="slide level2">
<h2>Implementing <code>addOneDay</code></h2>
<p>Another easy case!</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode idris"><code class="sourceCode idris"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Right</span> <span class="fu">_</span> <span class="ot">=&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">case</span> month <span class="kw">of</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">December</span> <span class="ot">=&gt;</span> <span class="dt">MkDate</span> (year <span class="fu">+</span> <span class="dv">1</span>) <span class="dt">January</span> <span class="dv">1</span></span></code></pre></div>
</section>
<section id="implementing-addoneday-2" class="slide level2">
<h2>Implementing <code>addOneDay</code></h2>
<p>The slightly trickier case</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode idris"><code class="sourceCode idris"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Right</span> <span class="fu">_</span> <span class="ot">=&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">case</span> month <span class="kw">of</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">December</span> <span class="ot">=&gt;</span> <span class="fu">...</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_</span>        <span class="ot">=&gt;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> firstDayOfMonth <span class="fu">=</span> aMonthHasOneDay (nextMonth month) year</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">in</span> <span class="dt">MkDate</span> year (nextMonth month) <span class="dv">1</span></span></code></pre></div>
<aside class="notes">
<ul>
<li>we need to provide a proof that 1 is a valid day for the next
month</li>
</ul>
</aside>
</section>
<section id="implementing-addoneday-3" class="slide level2">
<h2>Implementing <code>addOneDay</code></h2>
<div class="sourceCode" id="cb7"><pre
class="sourceCode idris"><code class="sourceCode idris"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">monthDuration</span> <span class="ot">:</span> <span class="dt">Month</span> <span class="ot">-&gt;</span> <span class="dt">Year</span> <span class="ot">-&gt;</span> (days<span class="ot">:</span> <span class="dt">Nat</span> <span class="fu">**</span> <span class="dt">LTE</span> <span class="dv">1</span> days)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">...</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">aMonthHasOneDay</span> <span class="ot">:</span> (month <span class="ot">:</span> <span class="dt">Month</span>) <span class="ot">-&gt;</span> (year <span class="ot">:</span> <span class="dt">Year</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>               <span class="ot">-&gt;</span> <span class="dt">LTE</span> <span class="dv">1</span> (daysInMonth month year)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>aMonthHasOneDay month year <span class="kw">with</span> (monthDuration month year)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">|</span> (<span class="fu">_</span> <span class="fu">**</span> prf) <span class="fu">=</span> prf</span></code></pre></div>
<aside class="notes">
<ul>
<li>We make use of Œ£-types, eg. type of tuples where the second type
depends on the fist one to construct an <code>LTE</code> proof that 1 is
always <code>LTE</code> than the days in the month</li>
</ul>
</aside>
</section>
<section id="testing-in-the-repl" class="slide level2">
<h2>Testing in the REPL</h2>
<pre><code>ŒªŒ†&gt; :let date = MkDate 2022 December 25
ŒªŒ†&gt; addDays 3 date
MkDate 2022 December 28 : Date
ŒªŒ†&gt; addDays 7 date
MkDate 2023 January 1 : Date</code></pre>
</section>
<section id="enforcing-invariants-at-the-hexagons-sides"
class="slide level2">
<h2>Enforcing Invariants at the Hexagon‚Äôs Sides</h2>
<p><img data-src="/images/hexagonal-architecture-complex.gif" /></p>
</section>
<section id="parser" class="slide level2">
<h2>Parser</h2>
<p>A building block for a better parser combinator-style parser</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode idris"><code class="sourceCode idris"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">toDate</span> <span class="ot">:</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">Either</span> <span class="dt">String</span> <span class="dt">Date</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>toDate y m d <span class="fu">=</span> <span class="kw">do</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  year <span class="ot">&lt;-</span> mkYear y</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  month <span class="ot">&lt;-</span> mkMonth m</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  day <span class="ot">&lt;-</span> mkDay d</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">case</span> isLTE day (daysInMonth month year) <span class="kw">of</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    (<span class="dt">Yes</span> prf) <span class="ot">=&gt;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>       <span class="kw">case</span> isLTE <span class="dv">1</span> day <span class="kw">of</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>         (<span class="dt">Yes</span> prf&#39;) <span class="ot">=&gt;</span> pure <span class="fu">$</span> <span class="dt">MkDate</span> year month day</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>         (<span class="dt">No</span> <span class="fu">_</span>) <span class="ot">=&gt;</span> <span class="dt">Left</span> <span class="st">&quot;Error: ...&quot;</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    (<span class="dt">No</span> <span class="fu">_</span>) <span class="ot">=&gt;</span> <span class="dt">Left</span> <span class="st">&quot;Error: ...&quot;</span></span></code></pre></div>
<aside class="notes">
<ul>
<li>use the <code>DecEq</code> type and <code>isLTE</code> function to
produce needed proofs that the day is within the bounds for the given
month</li>
<li>the <code>prf</code> and <code>prf'</code> are in scope when calling
the <code>MkDate</code> constructor so they are implicitly passed</li>
<li>this is a building block for a better parser combinator-style parser
which is provided by <code>lightyear</code> package</li>
<li>the types force us to take care of the various malformed cases in
<code>String</code></li>
</ul>
</aside>
</section>
<section id="testing-in-the-repl-1" class="slide level2">
<h2>Testing in the REPL</h2>
<pre><code>Type checking ./Date.idr
ŒªŒ†&gt; toDate &quot;2022&quot; &quot;2&quot; &quot;28&quot;
Right (MkDate 2022 February 28) : Either String Date
ŒªŒ†&gt; toDate &quot;2022&quot; &quot;2&quot; &quot;29&quot;
Left &quot;invalid number of days 29 in month 2 and year 2022&quot; : Either String Date</code></pre>
</section></section>
<section>
<section id="a-more-involved-example-accounting"
class="title-slide slide level1">
<h1>A more involved example: Accounting</h1>

</section>
<section id="double-entry-accounting-domain" class="slide level2">
<h2>Double-Entry Accounting Domain</h2>
<p>From <a
href="https://en.wikipedia.org/wiki/Double-entry_bookkeeping_system">Wikipedia</a></p>
<blockquote>
<p>In the double-entry accounting system, at least two accounting
entries are required to record each financial transaction. [..]
Recording of a debit amount to one or more accounts and an equal credit
amount to one or more accounts results in total debits being equal to
total credits for all accounts in the general ledger. ‚Ä¶</p>
</blockquote>
</section>
<section id="business-rules" class="slide level2">
<h2>Business rules</h2>
<ul>
<li class="fragment">A <em>transaction</em> comprises at least 2
<em>entries</em></li>
<li class="fragment">An <em>entry</em> records a <em>debit</em> or
<em>credit</em> amount in an <em>account</em></li>
<li class="fragment">An <em>account</em> can fall into 5 different
categories: <em>asset</em>, <em>liability</em>, <em>equity</em>,
<em>expense</em>, or <em>revenue</em></li>
<li class="fragment">The aggregate debit and credit <em>balance</em> of
all accounts should be equal</li>
<li class="fragment">A <em>book of accounts</em> should preserve a
<em>fundamental equation</em> that ensures <code>asset = liability +
equity</code></li>
</ul>
</section>
<section id="first-model" class="slide level2">
<h2>First Model</h2>
<p><code>Balance</code> as a simple amount + <code>Direction</code></p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode idris"><code class="sourceCode idris"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Balance</span> <span class="ot">:</span> <span class="dt">Type</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="dt">Balance</span> <span class="fu">=</span> (<span class="dt">Nat</span>, <span class="dt">Direction</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Account</span> <span class="ot">:</span> <span class="dt">Type</span> <span class="kw">where</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">MkAccount</span> <span class="ot">:</span> <span class="dt">String</span> <span class="ot">-&gt;</span> { type <span class="ot">:</span> <span class="dt">AccountType</span> } <span class="ot">-&gt;</span> <span class="dt">Account</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="kw">record</span> <span class="dt">Entry</span> <span class="kw">where</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">constructor</span> <span class="dt">MkEntry</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">amount</span> <span class="ot">:</span> <span class="dt">Balance</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">account</span> <span class="ot">:</span> <span class="dt">Account</span></span></code></pre></div>
</section>
<section id="first-model-transaction" class="slide level2">
<h2>First Model: Transaction</h2>
<p>A <code>Transaction</code> is some metadata + constrained vector of
<code>Entries</code></p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode idris"><code class="sourceCode idris"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Entries</span> <span class="ot">:</span> <span class="dt">Type</span> <span class="kw">where</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">MkEntries</span> <span class="ot">:</span> (entries <span class="ot">:</span> <span class="dt">Vect</span> n <span class="dt">Entry</span>) <span class="ot">-&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>              { <span class="kw">auto</span> need2Entries <span class="ot">:</span> <span class="dt">LTE</span> <span class="dv">2</span> n } <span class="ot">-&gt;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>              { <span class="kw">auto</span> balanced <span class="ot">:</span> balance entries <span class="fu">=</span> (<span class="dv">0</span>, <span class="dt">Cr</span>) } <span class="ot">-&gt;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>              <span class="dt">Entries</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="kw">record</span> <span class="dt">Transaction</span> <span class="kw">where</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">constructor</span> <span class="dt">Tx</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">label</span> <span class="ot">:</span> <span class="dt">String</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">date</span> <span class="ot">:</span> <span class="dt">Date</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">entries</span> <span class="ot">:</span> <span class="dt">Entries</span></span></code></pre></div>
<aside class="notes">
<ul>
<li>A transaction has at least 2 entries</li>
<li>The entries must be balanced =&gt; sum up to 0</li>
</ul>
</aside>
</section>
<section id="first-model-book-of-accounts" class="slide level2">
<h2>First Model: Book of Accounts</h2>
<p><code>BookOfAccounts</code> embeds the ‚Äúfundamental equation‚Äù
constraint</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode idris"><code class="sourceCode idris"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">BookOfAccounts</span> <span class="ot">:</span> <span class="dt">Type</span> <span class="kw">where</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">BookTransactions</span> <span class="ot">:</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>     (txs <span class="ot">:</span> <span class="dt">Vect</span> k <span class="dt">Transaction</span>) <span class="ot">-&gt;</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>     { <span class="kw">auto</span> fundamentalEquation <span class="ot">:</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>         inverse (assets txs <span class="fu">&lt;+&gt;</span> expenses txs) <span class="fu">=</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>           liabilities txs <span class="fu">&lt;+&gt;</span> capital txs <span class="fu">&lt;+&gt;</span> revenues txs } <span class="ot">-&gt;</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>     <span class="dt">BookOfAccounts</span></span></code></pre></div>
<aside class="notes">
<ul>
<li>directly express the equation as a type-level equality</li>
</ul>
</aside>
</section>
<section id="testing-with-the-compiler" class="slide level2">
<h2>Testing with the Compiler</h2>
<p>The <code>(=)</code> type allows us to write simple tests as
types!</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode idris"><code class="sourceCode idris"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">valid2</span> <span class="ot">:</span> balance [ <span class="dt">MkEntry</span> (<span class="dv">100</span>, <span class="dt">Cr</span>) <span class="dt">Bank</span>,</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">MkEntry</span> (<span class="dv">100</span>, <span class="dt">Dr</span>) <span class="dt">Capital</span> ] <span class="fu">=</span> (<span class="dv">0</span>, <span class="dt">Cr</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>valid2 <span class="fu">=</span> <span class="dt">Refl</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">invalid</span> <span class="ot">:</span> <span class="dt">Not</span> (balance [ <span class="dt">MkEntry</span> (<span class="dv">100</span>, <span class="dt">Cr</span>) <span class="dt">Bank</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>                         <span class="dt">MkEntry</span> (<span class="dv">101</span>, <span class="dt">Dr</span>) <span class="dt">Capital</span> ] <span class="fu">=</span> (<span class="dv">0</span>, <span class="dt">Cr</span>))</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>invalid <span class="fu">=</span> <span class="fu">\</span> <span class="dt">Refl</span> <span class="kw">impossible</span></span></code></pre></div>
<aside class="notes">
<ul>
<li>We can have negative tests too</li>
<li>I like having the tests close to the code</li>
<li>In general the testing story in Idris (2) is not so great (more on
this later)</li>
</ul>
</aside>
</section>
<section id="a-flaw-in-the-model" class="slide level2">
<h2>A Flaw in the Model</h2>
<p>Trying to prove the <code>Monoid</code> properties for a
<code>Balance</code> forced me to realize my model was wrong:</p>
<ul>
<li class="fragment">I am conflating two concepts: The <em>Balance</em>
and the <em>Amount</em> of each entry</li>
<li class="fragment"><code>Balance</code> should have a proper
domain-relevant representation</li>
<li class="fragment">Idris‚Äô compiler has a good way to tell you your
design is wrong: Proving properties becomes increasingly difficult (¬©
Ohad Kammar)</li>
</ul>
</section>
<section id="better-types" class="slide level2">
<h2>Better Types</h2>
<p>Separate the <code>Amount</code> from the <code>Direction</code> of
the <code>Balance</code></p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode idris"><code class="sourceCode idris"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Amount</span> <span class="ot">:</span> <span class="dt">Type</span> <span class="kw">where</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">MkAmount</span> <span class="ot">:</span> (n <span class="ot">:</span> <span class="dt">Nat</span>) <span class="ot">-&gt;</span> { <span class="kw">auto</span> notZero <span class="ot">:</span> <span class="dt">LTE</span> <span class="dv">1</span> n } <span class="ot">-&gt;</span> <span class="dt">Amount</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre
class="sourceCode idris"><code class="sourceCode idris"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Balance</span> <span class="ot">:</span> <span class="dt">Type</span> <span class="kw">where</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Zero</span> <span class="ot">:</span> <span class="dt">Balance</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Bal</span> <span class="ot">:</span> (n <span class="ot">:</span> <span class="dt">Amount</span>) <span class="ot">-&gt;</span> (d <span class="ot">:</span> <span class="dt">Direction</span>) <span class="ot">-&gt;</span> <span class="dt">Balance</span></span></code></pre></div>
<aside class="notes">
<ul>
<li>we distinguish the 0 (base) case just like for Peano numbers</li>
<li>there might be a more suitable representation to make
<code>Amount</code> strictly positive</li>
</ul>
</aside>
</section>
<section id="a-proper-monoid-instance" class="slide level2">
<h2>A proper <code>Monoid</code> instance</h2>
<p>Key function is <code>compensate</code> which produces a correct
<code>Balance</code> (which is isomorph to <span
class="math inline">‚Ñ§</span>)</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode idris"><code class="sourceCode idris"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Semigroup</span> <span class="dt">Balance</span> <span class="kw">where</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Zero</span>      <span class="fu">&lt;+&gt;</span> y           <span class="fu">=</span> y</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  x         <span class="fu">&lt;+&gt;</span> <span class="dt">Zero</span>        <span class="fu">=</span> x</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  (<span class="dt">Bal</span> n d) <span class="fu">&lt;+&gt;</span> (<span class="dt">Bal</span> n&#39; d&#39;) <span class="kw">with</span> (decEq d d&#39;)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">|</span> (<span class="dt">Yes</span> prf) <span class="fu">=</span> <span class="dt">Bal</span> (n <span class="fu">+</span> n&#39;) d</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">|</span> (<span class="dt">No</span> contra) <span class="fu">=</span> compensate n d n&#39; d&#39; { notEqDir <span class="fu">=</span> contra }</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="dt">Monoid</span> <span class="dt">Balance</span> <span class="kw">where</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  neutral <span class="fu">=</span> <span class="dt">Zero</span></span></code></pre></div>
<aside class="notes">
<ul>
<li><code>Balance</code> is actually a proper group</li>
<li>coding <code>compensate</code> was somewhat involved, and I needed a
bunch of lemmas to prove the substraction of the two numbers was not
zero</li>
</ul>
</aside>
</section>
<section id="enforcing-invariants-upon-reading" class="slide level2">
<h2>Enforcing Invariants upon Reading</h2>
<p>To build a <code>BookOfAccounts</code> we need to provide the
required proof transactions are balanced.</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode idris"><code class="sourceCode idris"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">parseBookOfAccounts</span> <span class="ot">:</span> <span class="dt">Parser</span> <span class="dt">BookOfAccounts</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>parseBookOfAccounts <span class="fu">=</span> <span class="kw">do</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  rawTxs <span class="ot">&lt;-</span> sepBy parseTransaction (many endOfLine)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> txs <span class="fu">=</span> fromList rawTxs</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">case</span> decEq (inverse (assets txs <span class="fu">&lt;+&gt;</span> expenses txs))</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>             (liabilities txs <span class="fu">&lt;+&gt;</span> capital txs <span class="fu">&lt;+&gt;</span> revenues txs) <span class="kw">of</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    (<span class="dt">Yes</span> prf) <span class="ot">=&gt;</span> pure <span class="fu">$</span> <span class="dt">BookTransactions</span> txs</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    (<span class="dt">No</span> contra) <span class="ot">=&gt;</span> fail <span class="st">&quot;Transactions are not balanced, assets should equal sum of liabilities and capital&quot;</span></span></code></pre></div>
</section>
<section id="arnaud-in-wonderland" class="slide level2">
<h2>Arnaud In Wonderland</h2>
<p>Things start to get tricky when trying (again) to prove
<code>Monoid</code> properties on a <code>Balance</code></p>
<p><img data-src="/images/balance-proof.png" /></p>
</section>
<section id="arnaud-in-wonderland-1" class="slide level2">
<h2>Arnaud In Wonderland</h2>
<ul>
<li class="fragment"><a
href="https://github.com/abailly/xxi-century-typed/blob/master/idris/src/Accounting/Proofs.idr">Proofs</a>
of <em>associativity</em> quickly became bogged down into a maze of
various cases</li>
<li class="fragment">Embedding proofs in <em>data types</em> means we
have to <em>discharge</em> those proofs to construct values, which leds
to more work</li>
<li class="fragment">The <code>Balance</code> representation is probably
still wrong and needs to be <em>distilled</em></li>
</ul>
</section></section>
<section>
<section id="a-complete-application-bautzen-1945"
class="title-slide slide level1">
<h1>A Complete Application: Bautzen 1945</h1>

</section>
<section id="background" class="slide level2">
<h2>Background</h2>
<p><img data-src="/images/vaevictis-135.jpeg" /></p>
<aside class="notes">
<ul>
<li>I used to play wargames when I were younger but stopped out of lack
of time and partners</li>
<li>Vae Victis is a magazine that proposes short and easy to play games
every 2 months (similar to Strategy &amp; Tactics in the US)</li>
<li>I wanted to do something more involved in Idris</li>
<li>A game sounded like the right fit</li>
</ul>
</aside>
</section>
<section id="challenges" class="slide level2">
<h2>Challenges</h2>
<ul>
<li class="fragment">Idris does (or did) not have much support for Web
Apps: No native HTTP(S) server, no API/UI/HTML framework, no JSON‚Ä¶</li>
<li class="fragment">Edwin Brady developed Idris 2 while I was half-way
through the game!</li>
<li class="fragment">Support for Concurrency, multithreading, networking
are also quite nascent and depends a lot on the backend</li>
</ul>
</section>
<section id="short-history" class="slide level2">
<h2>Short history</h2>
<ul>
<li class="fragment">Spring 2019: Started coding pure game logic in
Idris1</li>
<li class="fragment">Autumn 2019: Converted existing code to Idris2</li>
<li class="fragment">2020: Client and server executables, stuck with
networking</li>
<li class="fragment">2021: Not much work, busy building Hydra</li>
<li class="fragment">2022: Make it playable with UI in browser</li>
</ul>
<aside class="notes">
<ul>
<li>basic event-sourced architecture in mind (eg.
<code>Command</code>/<code>Event</code> )</li>
<li>got a basic client-server single game executable working reasonably
quickly</li>
<li>had to port networking code from Idris1 to 2</li>
<li>got stuck for a while because of a subtle issue in how C FFI works
in Chez scheme (someone else found the issue)</li>
<li>put a haskell proxy in front of server to provide WS support</li>
</ul>
</aside>
</section>
<section id="idris-1-rightarrow-idris-2" class="slide level2">
<h2>Idris 1 <span class="math inline">‚Üí</span> Idris 2</h2>
<ul>
<li class="fragment">Idris2 was a full rewrite of the compiler using
Idris (1, then 2) itself</li>
<li class="fragment">It‚Äôs based on <a
href="https://arxiv.org/abs/2104.00480">Quantitative Type Theory</a> (<a
href="https://www.researchgate.net/publication/326024161_Syntax_and_Semantics_of_Quantitative_Type_Theory">Atkey,
2018</a>)</li>
<li class="fragment">It (initially) used <a
href="https://cisco.github.io/ChezScheme/">Chez Scheme</a> as its code
generation backend</li>
<li class="fragment">Had degraded DevX initially</li>
</ul>
<aside class="notes">
<ul>
<li>QTT generalises irrelevance and linearity by allowing to add
quantities 0, 1, or œâ to symbol‚Äôs declarations</li>
<li>using scheme seems quite a smart move as it gives one a full blown
RTS and optimising compiler for ‚Äúfree‚Äù</li>
<li>Lack of libs, lots of small differences that might entail
significant changes in the code, lack of good IDE support‚Ä¶</li>
<li>it‚Äôs getting better over time of course</li>
</ul>
</aside>
</section>
<section id="the-project-today" class="slide level2">
<h2>The project today</h2>
<p><img data-src="/images/bautzen-map.png" /></p>
</section>
<section id="the-project-today-1" class="slide level2">
<h2>The project today</h2>
<ul>
<li class="fragment">45 Idris2 source files for a total of 4360 LoC</li>
<li class="fragment">Got basic interactions and game flow working</li>
<li class="fragment">Far from being able to play a full game but it‚Äôs
taking shape!</li>
<li class="fragment">checkout project on <a
href="https://github.com/abailly/hsgames/">GitHub</a></li>
</ul>
</section>
<section id="juicy-bits-command-and-event" class="slide level2">
<h2>Juicy Bits: Command and Event</h2>
<div class="sourceCode" id="cb19"><pre
class="sourceCode idris"><code class="sourceCode idris"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Command</span> <span class="ot">:</span> <span class="dt">Type</span> <span class="kw">where</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Place</span> <span class="ot">:</span> (unitName <span class="ot">:</span> <span class="dt">String</span>) <span class="ot">-&gt;</span> (pos <span class="ot">:</span> <span class="dt">Pos</span>) <span class="ot">-&gt;</span> <span class="dt">Command</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">MoveTo</span> <span class="ot">:</span> (unitName <span class="ot">:</span> <span class="dt">String</span>) <span class="ot">-&gt;</span> (to <span class="ot">:</span> <span class="dt">Pos</span>) <span class="ot">-&gt;</span> <span class="dt">Command</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">...</span></span></code></pre></div>
<aside class="notes">
<ul>
<li>Command expresses the ‚Äúinputs‚Äù to the game and as such is not
dependent: Possibly the user can issue an invalid command at any
time</li>
<li>simpler type</li>
</ul>
</aside>
</section>
<section id="juicy-bits-command-and-event-1" class="slide level2"
data-transition="none">
<h2 data-transition="none">Juicy Bits: Command and Event</h2>
<div class="sourceCode" id="cb20"><pre
class="sourceCode idris"><code class="sourceCode idris"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Event</span> <span class="ot">:</span> (segment <span class="ot">:</span> <span class="dt">GameSegment</span>) <span class="ot">-&gt;</span> <span class="dt">Type</span> <span class="kw">where</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Placed</span> <span class="ot">:</span> (unit <span class="ot">:</span> <span class="dt">GameUnit</span>) <span class="ot">-&gt;</span> (pos <span class="ot">:</span> <span class="dt">Pos</span>) <span class="ot">-&gt;</span> <span class="dt">Event</span> <span class="dt">Setup</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Moved</span> <span class="ot">:</span> (unit <span class="ot">:</span> <span class="dt">GameUnit</span>) <span class="ot">-&gt;</span> (from <span class="ot">:</span> <span class="dt">Pos</span>) <span class="ot">-&gt;</span> (to <span class="ot">:</span> <span class="dt">Pos</span>) <span class="ot">-&gt;</span> (cost <span class="ot">:</span> <span class="dt">Cost</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>        <span class="ot">-&gt;</span> { <span class="kw">auto</span> prf <span class="ot">:</span> <span class="dt">LTE</span> (toNat cost) (currentMP unit) }</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>        <span class="ot">-&gt;</span> <span class="dt">Event</span> <span class="dt">Move</span></span></code></pre></div>
<aside class="notes">
<ul>
<li>Events need to be richer and express proper constraints of the
underlying model (game)</li>
<li>Type is indexed by the segment in which the event is valid</li>
<li><code>Moved</code> has an additional constraint to guarantee cost is
within MPs of the unit</li>
</ul>
</aside>
</section>
<section id="juicy-bits-command-and-event-2" class="slide level2"
data-transition="none">
<h2 data-transition="none">Juicy Bits: Command and Event</h2>
<p>Type-safe event-sourced application</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode idris"><code class="sourceCode idris"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">act</span> <span class="ot">:</span> (game <span class="ot">:</span> <span class="dt">Game</span>) <span class="ot">-&gt;</span> <span class="dt">Command</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="ot">-&gt;</span> <span class="dt">Either</span> <span class="dt">GameError</span> (<span class="dt">Event</span> (curSegment game))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span> <span class="ot">:</span> (st <span class="ot">:</span> <span class="dt">GameState</span>) <span class="ot">-&gt;</span> <span class="dt">Event</span> (st<span class="fu">.</span>stateSegment)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>      <span class="ot">-&gt;</span> <span class="dt">GameState</span></span></code></pre></div>
<aside class="notes">
<ul>
<li>act guarantees it produces an <code>Event</code> which is valid for
the <code>Game</code>‚Äôs segment</li>
<li>apply guarantees it can only ever be called with an event valid for
the current game segment</li>
</ul>
</aside>
</section>
<section id="dependent-pair-in-action" class="slide level2">
<h2>Dependent Pair in Action</h2>
<p>Using dependent pairs to provide a proof the cost of movement is
valid</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode idris"><code class="sourceCode idris"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">movementCost</span> <span class="ot">:</span> (unit <span class="ot">:</span> <span class="dt">GameUnit</span>) <span class="ot">-&gt;</span> <span class="fu">...</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="ot">-&gt;</span> <span class="dt">Either</span> <span class="dt">GameError</span> (cost <span class="ot">:</span> <span class="dt">Cost</span> <span class="fu">**</span> <span class="dt">LTE</span> (toNat cost) (currentMP unit))</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>movementCost unit <span class="fu">....</span> <span class="kw">with</span> (cost <span class="fu">...</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  movementCost unit  <span class="fu">|</span> <span class="dt">Impossible</span> <span class="fu">=</span> <span class="dt">Left</span> (<span class="dt">ForbiddenTerrain</span> from to)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  movementCost unit  <span class="fu">|</span> c <span class="fu">=</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">case</span> isLTE (toNat c) (currentMP unit) <span class="kw">of</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">Yes</span> prf <span class="ot">=&gt;</span> <span class="dt">Right</span> (c <span class="fu">**</span> prf)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>      <span class="dt">No</span> <span class="fu">_</span>    <span class="ot">=&gt;</span> <span class="dt">Left</span> (<span class="dt">NotEnoughMPs</span> unit from to (toNat c))</span></code></pre></div>
<aside class="notes">
<ul>
<li>This is required to build a proper <code>Moved</code> event!</li>
</ul>
</aside>
</section>
<section id="juicy-bits-domain-language" class="slide level2">
<h2>Juicy Bits: Domain Language</h2>
<p>Trying to stay as close as possible to how the rules are expressed in
English (actually French‚Ä¶)</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode idris"><code class="sourceCode idris"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>stacking units terrain <span class="fu">=</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> moreThan2DifferentFormations <span class="fu">||</span> unitsFromDifferentNations</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">then</span> <span class="dt">CannotStack</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">else</span> <span class="kw">let</span> sp <span class="fu">=</span> sum <span class="fu">$</span> map sps units</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>       <span class="kw">in</span> <span class="kw">if</span> sp <span class="fu">&lt;=</span> stackingLimit terrain</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>          <span class="kw">then</span> <span class="dt">Stacked</span> sp</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>          <span class="kw">else</span> <span class="dt">Overstacked</span> sp</span></code></pre></div>
</section>
<section id="juicy-bits-functional-data-structures"
class="slide level2">
<h2>Juicy Bits: Functional Data Structures</h2>
<p>Implement A* algorithm using <a
href="https://www.cs.cmu.edu/~rwh/theses/okasaki.pdf">Okasaki</a>‚Äôs
Heap</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode idris"><code class="sourceCode idris"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">computeShortestPath</span> <span class="ot">:</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  (fuel <span class="ot">:</span> <span class="dt">Nat</span>) <span class="ot">-&gt;</span> (units <span class="ot">:</span> <span class="dt">List</span> (<span class="dt">GameUnit</span>, <span class="dt">Pos</span>))</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>   <span class="ot">-&gt;</span> (gameMap <span class="ot">:</span> <span class="dt">Map</span>) <span class="ot">-&gt;</span> (unit <span class="ot">:</span> <span class="dt">GameUnit</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>   <span class="ot">-&gt;</span> (costsMap <span class="ot">:</span> <span class="dt">SortedMap</span> <span class="dt">Pos</span> <span class="dt">Nat</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>   <span class="ot">-&gt;</span> <span class="dt">BinaryHeap</span> <span class="dt">AState</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>   <span class="ot">-&gt;</span> <span class="dt">List</span> <span class="dt">Pos</span></span></code></pre></div>
<aside class="notes">
<ul>
<li>Tried to implement a Binomial Heap but I gave up after a while
because of the complexity of binary arithmetics</li>
<li>Tried to get inspiration from implementations in Agda and Coq but
failed</li>
</ul>
</aside>
</section>
<section id="juicy-bits-functional-data-structures-1"
class="slide level2">
<h2>Juicy Bits: Functional Data Structures</h2>
<p>There are some interesting use of <code>rewrite</code> here‚Ä¶</p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode idris"><code class="sourceCode idris"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>  mergeTree (<span class="dt">Node</span> elem left right {k} {n})</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>            (<span class="dt">Node</span> elem&#39; left&#39; right&#39; {k<span class="fu">=</span>k1} {n<span class="fu">=</span>n1}) <span class="fu">|</span> <span class="dt">False</span> <span class="fu">=</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">rewrite</span> sym (plusSuccRightSucc (k <span class="fu">+</span> n) (k1 <span class="fu">+</span> n1)) <span class="kw">in</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">rewrite</span> plusCommutative (plus k n) (plus k1 n1) <span class="kw">in</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">rewrite</span> plusSuccRightSucc (k1 <span class="fu">+</span> n1) (k <span class="fu">+</span> n) <span class="kw">in</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">rewrite</span> sym (plusAssociative k1 n1 (<span class="dt">S</span> (k <span class="fu">+</span> n))) <span class="kw">in</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">rewrite</span> plusCommutative n1 (<span class="dt">S</span> (plus k n)) <span class="kw">in</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    makeNode elem&#39; left&#39;</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>       (mergeTree (<span class="dt">Node</span> elem left right) right&#39;)</span></code></pre></div>
</section>
<section id="juicy-bits-functional-data-structures-2"
class="slide level2" data-transition="none">
<h2 data-transition="none">Juicy Bits: Functional Data Structures</h2>
<p>By the way, I lied!</p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode idris"><code class="sourceCode idris"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>  mergeTree (<span class="dt">Node</span> elem left right {k} {n})</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>            (<span class="dt">Node</span> elem&#39; left&#39; right&#39; {k<span class="fu">=</span>k1} {n<span class="fu">=</span>n1}) <span class="fu">|</span> <span class="dt">False</span> <span class="fu">=</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">rewrite</span> sym (plusSuccRightSucc (k <span class="fu">+</span> n) (k1 <span class="fu">+</span> n1)) <span class="kw">in</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">rewrite</span> plusCommutative (plus k n) (plus k1 n1) <span class="kw">in</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">rewrite</span> plusSuccRightSucc (k1 <span class="fu">+</span> n1) (k <span class="fu">+</span> n) <span class="kw">in</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">rewrite</span> sym (plusAssociative k1 n1 (<span class="dt">S</span> (k <span class="fu">+</span> n))) <span class="kw">in</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">rewrite</span> plusCommutative n1 (<span class="dt">S</span> (plus k n)) <span class="kw">in</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    makeNode elem&#39; left&#39;</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>       (assert_total <span class="fu">$</span> mergeTree (<span class="dt">Node</span> elem left right) right&#39;)</span></code></pre></div>
<aside class="notes">
<ul>
<li>I was unable to convince the typechecker this function is
<em>total</em> although it looks so as we keep reducing the size of our
arguments</li>
<li>Used the ‚Äúatomic weapon‚Äù to still declare the function is total</li>
<li>What am I doing wrong?</li>
</ul>
</aside>
</section>
<section id="juicy-bits-arithmetics" class="slide level2">
<h2>Juicy Bits: Arithmetics</h2>
<p>Use <code>Fin n</code> finite integers to ensure positions are always
within the map‚Äôs bounds</p>
<div class="sourceCode" id="cb27"><pre
class="sourceCode idris"><code class="sourceCode idris"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Loc</span> <span class="ot">:</span> (c <span class="ot">:</span> <span class="dt">Nat</span>) <span class="ot">-&gt;</span> (r <span class="ot">:</span> <span class="dt">Nat</span>) <span class="ot">-&gt;</span> <span class="dt">Type</span> <span class="kw">where</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Hex</span> <span class="ot">:</span> (col <span class="ot">:</span> <span class="dt">Fin</span> c) <span class="ot">-&gt;</span> (row <span class="ot">:</span> <span class="dt">Fin</span> r) <span class="ot">-&gt;</span> <span class="dt">Loc</span> c r</span></code></pre></div>
<aside class="notes">
<ul>
<li>The grid is hexagonal</li>
<li>Fin n are somewhat cumbersome to manipulate in general but they are
a good fit here because the map is small (eg. 23 x 13 elements</li>
</ul>
</aside>
</section>
<section id="juicy-bits-arithmetics-1" class="slide level2">
<h2>Juicy Bits: Arithmetics</h2>
<p>Use some <a
href="https://www.redblobgames.com/grids/hexagons/">clever</a>
intermediate representation for distance in hexagonal grid</p>
<div class="sourceCode" id="cb28"><pre
class="sourceCode idris"><code class="sourceCode idris"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Cube</span> <span class="ot">:</span> <span class="dt">Type</span> <span class="kw">where</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">MkCube</span> <span class="ot">:</span> (x <span class="ot">:</span> <span class="dt">ZZ</span>) <span class="ot">-&gt;</span> (z <span class="ot">:</span> <span class="dt">ZZ</span>) <span class="ot">-&gt;</span> <span class="dt">Cube</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cubeDistance</span> <span class="ot">:</span> <span class="dt">Cube</span> <span class="ot">-&gt;</span> <span class="dt">Cube</span> <span class="ot">-&gt;</span> <span class="dt">Nat</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>cubeDistance (<span class="dt">MkCube</span> x z) (<span class="dt">MkCube</span> x&#39; z&#39;) <span class="fu">=</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> y  <span class="fu">=</span> negate x <span class="fu">-</span> z</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>      y&#39; <span class="fu">=</span> negate x&#39; <span class="fu">-</span> z&#39;</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">in</span> max (max (absZ (x <span class="fu">-</span> x&#39;)) (absZ (y <span class="fu">-</span> y&#39;))) (absZ (z <span class="fu">-</span> z&#39;))</span></code></pre></div>
</section>
<section id="error-handling" class="slide level2">
<h2>Error Handling</h2>
<p>There are no exceptions in Idris but it provide syntax to
shortcircuit flow in monadic code</p>
<div class="sourceCode" id="cb29"><pre
class="sourceCode idris"><code class="sourceCode idris"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>serve log sock clients gamesOutput gamesState <span class="fu">=</span> <span class="kw">do</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  log <span class="st">&quot;awaiting clients&quot;</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Right</span> (s, addr) <span class="ot">&lt;-</span> accept sock</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">|</span> <span class="dt">Left</span> err <span class="ot">=&gt;</span> pure (<span class="dt">Left</span> <span class="st">&quot;Error&quot;</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  log <span class="fu">$</span> <span class="st">&quot;client connecting from &quot;</span> <span class="fu">++</span> show addr</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Right</span> clientId <span class="ot">&lt;-</span> clientHandshake log s</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">|</span>  <span class="dt">Left</span> err <span class="ot">=&gt;</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>          <span class="kw">do</span> log <span class="st">&quot;Error&quot;</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>             close s</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>             serve log sock clients gamesOutput gamesState</span></code></pre></div>
</section></section>
<section>
<section id="conclusion" class="title-slide slide level1">
<h1>Conclusion</h1>

</section>
<section id="takeaways-modelling" class="slide level2">
<h2>Takeaways: Modelling</h2>
<ul>
<li class="fragment">Proving things about your domain‚Äôs model is
<em>fun</em> and <em>rewarding</em></li>
<li class="fragment">Relating domain-level concepts to more abstract
concepts can be a source of insights on the domain itself</li>
<li class="fragment">Trying to prove the relevant properties gives more
insights on the <em>representation</em> used</li>
</ul>
</section>
<section id="takeaways-idris-vs.-haskell" class="slide level2">
<h2>Takeaways: Idris vs.¬†Haskell</h2>
<ul>
<li class="fragment">Dependent Types in Idris are much easier to work
with than in Haskell</li>
<li class="fragment">Interacting with the compiler through
<em>holes</em> has better integration in IDE</li>
<li class="fragment">Eco-system is of course way smaller but adding
backends and FFI are ‚Äúeasy‚Äù</li>
<li class="fragment">Not having accumulated 30 years of development
means the barrier to contribution is pretty low (I could do it!)</li>
</ul>
<aside class="notes">
<ul>
<li>I did not show interactive editing and use of IDE tooling</li>
<li>It‚Äôs still rough but already provides a lot of stuff that we are
only recently getting in Haskell: navigation, local types</li>
<li>Existing backends for JS, C, various Schemes‚Ä¶ so could be a good
alternative to native libraries</li>
</ul>
</aside>
</section>
<section id="things-not-covered" class="slide level2">
<h2>Things Not Covered</h2>
<p>(Either not shown here or unknown to me‚Ä¶)</p>
<ul>
<li class="fragment">Interactive editing</li>
<li class="fragment">Linear types and linear I/O</li>
<li class="fragment">Elaborator Reflection and meta-programming</li>
<li class="fragment">Packages management</li>
<li class="fragment">‚Ä¶ <span class="math inline">‚Üí</span> Edwin Brady‚Äôs
<a href="https://www.youtube.com/watch?v=nbClauMCeds">video</a></li>
</ul>
</section>
<section id="the-book" class="slide level2">
<h2>The Book</h2>
<p><img
data-src="https://images.manning.com/720/960/resize/book/1/453215a-afa1-443f-9f2d-3b6bf24c34db/Brady-TDDI-HI.png" /></p>
</section>
<section id="links" class="slide level2">
<h2>Links</h2>
<ul>
<li class="fragment">Idris <a href="https://discord.gg/AbuHWhzh">Discord
Server</a> is very welcoming</li>
<li class="fragment">This talk stemmed from a series of blog posts: <a
href="http://abailly.github.io/posts/dependently-typed-accounting.html">http://abailly.github.io/posts/dependently-typed-accounting.html</a></li>
<li class="fragment">Code for <code>Date</code> and
<code>Accounting</code>: <a
href="https://github.com/abailly/xxi-century-typed/blob/master/idris/src/Accounting.idr">https://github.com/abailly/xxi-century-typed</a></li>
<li class="fragment">Code for Bautzen 1945:
https://github.com/abailly/hsgames/blob/master/bautzen1945/</li>
</ul>
</section>
<section id="questions" class="slide level2">
<h2>Questions?</h2>
<p><img data-src="/images/puzzled.jpg" /></p>
</section></section>
    </div>
  </div>

  <script src="/reveal.js/dist/reveal.js"></script>

  <!-- reveal.js plugins -->
  <script src="/reveal.js/plugin/notes/notes.js"></script>
  <script src="/reveal.js/plugin/search/search.js"></script>
  <script src="/reveal.js/plugin/zoom/zoom.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
        // Display controls in the bottom right corner
        controls: true,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: true,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'bottom-right',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: false,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: true,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'default',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: true,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'slide',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'fade',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // reveal.js plugins
        plugins: [
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    </body>
</html>
